<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reportes y Asignaci√≥n</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlalDLuUpqj7JjLzW4z5L4v8kPz8S8V3uU3L5F5L5j7g5L5v5L5w5L5x5L5y5L5z5L5a5b5c5d5e5f5g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a7e0f2 0%, #d8f5ff 100%); /* More vibrant blue gradient */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem;
            color: #334155; /* Default text color */
        }
        .main-container {
            background: linear-gradient(135deg, #f0f4f8 0%, #ffffff 100%); /* Soft gradient for the main container */
            padding: 2.5rem; /* Increased padding */
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2), 0 8px 15px rgba(0, 0, 0, 0.1); /* Deeper, more noticeable shadow */
            width: 100%;
            max-width: 950px; /* Adjusted max-width to accommodate tabs better */
            border: 1px solid #e2e8f0;
            transform: translateY(0);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        .main-container:hover {
            transform: translateY(-5px); /* Slight lift on hover */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25), 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        .header h1 {
            font-size: 3.2rem; /* Even larger main title */
            font-weight: 800;
            color: #0d47a1; /* Darker blue for main title */
            text-shadow: 2px 2px 5px rgba(0,0,0,0.15); /* More prominent shadow */
            margin-bottom: 0.75rem;
        }
        .header p {
            font-size: 1.2rem; /* Slightly larger text */
            color: #4a5568;
        }
        .tabs-container {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 2rem;
            overflow-x: auto; /* Allow horizontal scrolling for tabs on small screens */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            justify-content: center; /* Center tabs */
            gap: 1rem; /* Space between tabs */
        }
        .tab-button {
            padding: 0.8rem 1.8rem; /* Increased padding */
            font-weight: 700;
            color: #64748b;
            cursor: pointer;
            border-bottom: 3px solid transparent; /* Thicker transparent border */
            transition: all 0.3s ease-in-out;
            white-space: nowrap; /* Prevent tab text from wrapping */
            background-color: transparent;
            border-top-left-radius: 0.6rem;
            border-top-right-radius: 0.6rem;
            position: relative;
        }
        .tab-button:hover {
            color: #1976d2; /* Darker blue on hover */
            background-color: #e0f2f7; /* Lighter blue on hover */
            border-bottom-color: #3f51b5; /* Highlight border on hover */
            transform: translateY(-2px); /* Slight lift on hover */
        }
        .tab-button.active {
            color: #1976d2; /* Darker blue when active */
            border-bottom: 4px solid #1976d2; /* Even thicker border for active */
            background-color: #e6f3fb; /* More distinct light blue background */
            font-weight: 800; /* Make active tab text bolder */
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1); /* Stronger shadow on active tab */
            transform: translateY(-3px); /* More noticeable lift on active */
        }
        .tab-content {
            display: none; /* Hide all tab content by default */
            padding: 1.5rem 0; /* Padding for content */
        }
        .tab-content.active {
            display: block; /* Show active tab content */
        }

        /* --- Common Styles for all forms within tabs --- */
        .form-section-container { /* Renamed from cleaning-report-section to be more generic */
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05), 0 4px 10px rgba(0, 0, 0, 0.03);
            width: 100%;
            border: 1px solid #e2e8f0;
        }
        .form-section-container h1 { /* Adjusted title for embedded forms */
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
        }
        h2 {
            font-size: 1.85rem;
            font-weight: 700;
            color: #2c3e50;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }
        h3 {
            font-size: 1.35rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 1rem;
        }
        .input-group label {
            font-weight: 600;
            margin-bottom: 0.7rem;
            display: block;
            color: #4a5568;
            font-size: 1rem;
        }
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #c0d4e7;
            border-radius: 0.8rem;
            font-size: 1.1rem;
            color: #2d3748;
            transition: all 0.3s ease-in-out;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.08);
        }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 5px rgba(63, 81, 181, 0.4), inset 0 2px 5px rgba(0, 0, 0, 0.1);
            background-color: #f0f8ff;
        }
        .btn {
            padding: 1rem 2.2rem;
            border-radius: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            letter-spacing: 0.03em;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            text-transform: uppercase;
        }
        .btn-primary {
            background: linear-gradient(45deg, #42a5f5, #1976d2);
            color: white;
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #1976d2, #3f51b5);
            box-shadow: 0 8px 20px rgba(25, 118, 210, 0.5);
            transform: translateY(-3px);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #90a4ae, #607d8b);
            color: white;
            border: none;
        }
        .btn-secondary:hover {
            background: linear-gradient(45deg, #607d8b, #455a64);
            box-shadow: 0 8px 20px rgba(96, 125, 139, 0.5);
            transform: translateY(-3px);
        }
        .btn-danger {
            background: linear-gradient(45deg, #ef5350, #d32f2f);
            color: white;
            border: none;
        }
        .btn-danger:hover {
            background: linear-gradient(45deg, #d32f2f, #c62828);
            box-shadow: 0 8px 20px rgba(211, 47, 47, 0.5);
            transform: translateY(-3px);
        }
        .cleaner-section { /* Also used for responsible cleaner sections in assignment form */
            background-color: #f8faff;
            border: 1px solid #c7e7f6;
            border-radius: 1.2rem;
            padding: 2.2rem;
            margin-bottom: 2rem;
            position: relative;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        .cleaner-section:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .cleaner-section .remove-cleaner-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #ef5350;
            color: white;
            border-radius: 9999px;
            padding: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
            transition: all 0.2s ease-in-out;
        }
        .cleaner-section .remove-cleaner-btn:hover {
            background-color: #d32f2f;
            transform: scale(1.15);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.35);
        }
        .area-item { /* Also used for activities in assignment form */
            display: flex;
            align-items: center;
            gap: 1.25rem;
            margin-bottom: 1rem;
            background-color: #f0f7fc;
            padding: 1.2rem;
            border-radius: 0.85rem;
            border: 1px solid #d4ebf8;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease-in-out;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .area-item:hover {
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        .area-item input[type="text"] {
            flex-grow: 1;
            min-width: 150px;
            margin-right: 0;
        }
        .area-item .toggle-switch {
            position: relative;
            display: inline-block;
            width: 70px;
            height: 38px;
            flex-shrink: 0;
        }
        .area-item .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .area-item .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #bdbdbd;
            transition: .4s;
            border-radius: 38px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.25);
        }
        .area-item .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        }
        .area-item input:checked + .slider {
            background-color: #66bb6a;
        }
        .area-item input:focus + .slider {
            box-shadow: 0 0 1px #66bb6a;
        }
        .area-item input:checked + .slider:before {
            transform: translateX(32px);
        }
        .area-item .status-label {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
            min-width: 60px;
            text-align: center;
            transition: all 0.3s ease-in-out;
            flex-shrink: 0;
        }
        .status-label[data-status="dirty"] {
            color: #c62828;
        }
        .status-label[data-status="clean"] {
            color: #388e3c;
        }
        .area-item .remove-area-btn {
            flex-shrink: 0;
            margin-left: auto;
        }
        .message-box {
            background: linear-gradient(45deg, #ffe082, #ffb300);
            border: 1px solid #ffca28;
            color: #5d4037;
            padding: 1.5rem;
            border-radius: 0.85rem;
            margin-top: 2rem;
            display: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styles specific to Turno Entrega activities */
        .activity-item-full {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1rem;
            background-color: #f0f7fc;
            padding: 1.2rem;
            border-radius: 0.85rem;
            border: 1px solid #d4ebf8;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease-in-out;
        }
        .activity-item-full:hover {
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        .activity-item-full .status-icon {
            font-size: 1.5rem; /* Larger icons */
            width: 2rem; /* Fixed width for alignment */
            text-align: center;
        }
        .activity-item-full input[type="checkbox"] {
            min-width: 1.25rem; /* Ensure checkbox is visible */
            min-height: 1.25rem;
            margin-right: 0.5rem;
        }
        .activity-item-full .activity-main-line {
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: space-between;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .activity-item-full .activity-text {
            font-weight: 600;
            color: #2d3748;
            flex-grow: 1; /* Allow text to take available space */
        }
        .activity-item-full .not-done-comment-container,
        .activity-item-full .specific-comment-container {
            width: 100%; /* Take full width below on small screens */
        }
        @media (min-width: 640px) { /* Tailwind's sm breakpoint */
            .activity-item-full {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
            }
            .activity-item-full .activity-main-line {
                flex-wrap: nowrap;
            }
            .activity-item-full .not-done-comment-container,
            .activity-item-full .specific-comment-container {
                width: auto; /* Revert to auto width on larger screens */
                margin-left: auto; /* Push to the right */
            }
        }
        /* Responsive adjustments for very small screens */
        @media (max-width: 480px) {
            .main-container {
                padding: 1.5rem;
            }
            .header h1 {
                font-size: 2.2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .form-section-container h1 {
                font-size: 1.8rem;
            }
            .cleaner-section {
                padding: 1.5rem;
            }
            .area-item, .activity-item-full {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                padding: 1rem;
            }
            .area-item input[type="text"], .activity-item-full input[type="text"] {
                width: 100%;
                min-width: unset;
            }
            .area-item .status-label, .activity-item-full .status-label {
                min-width: unset;
                text-align: left;
            }
            .area-item .toggle-switch, .activity-item-full .toggle-switch {
                align-self: flex-end;
            }
            .area-item .remove-area-btn, .activity-item-full .remove-dynamic-activity-btn {
                align-self: flex-end;
                margin-left: 0;
            }
            .activity-item-full .activity-main-line {
                flex-direction: column;
                align-items: flex-start;
            }
            .activity-item-full .status-icon {
                margin-left: 0; /* Remove margin on small screens if stacked */
                margin-top: 0.5rem; /* Add some top margin if stacked */
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="header">
            <h1><i class="fas fa-tasks mr-3 text-blue-700"></i>Panel de Control de Actividades</h1>
            <p>Genera y env√≠a tus reportes y asignaciones de limpieza f√°cilmente.</p>
        </header>

        <div class="tabs-container">
            <button class="tab-button active" onclick="showTab('cleaningReportTab')">Reporte de Limpieza</button>
            <button class="tab-button" onclick="showTab('assignAreasTab')">Asignar √Åreas de Limpieza</button>
            <button class="tab-button" onclick="showTab('turnoEntregaTab')">Actividades Entrega de Turno</button>
        </div>

        <!-- Pesta√±a: Reporte de Limpieza -->
        <div id="cleaningReportTab" class="tab-content active">
            <div class="form-section-container">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8"><i class="fas fa-file-alt mr-2 text-blue-600"></i>Reporte de Limpieza</h1>

                <form id="cleaningReportForm" class="space-y-6">
                    <!-- Nuevos Selectores para Tipo de Reporte y Tipo de Limpieza -->
                    <div class="input-group">
                        <label for="reportType"><i class="fas fa-folder-open mr-2 text-gray-600"></i>Tipo de Reporte:</label>
                        <select id="reportType" name="reportType" class="rounded-lg" required>
                            <option value="">Selecciona el tipo de reporte</option>
                            <option value="Reporte de Limpieza Dulcer√≠a">Dulcer√≠a</option>
                            <option value="Reporte de Limpieza Operaciones">Operaciones</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="cleaningType"><i class="fas fa-broom mr-2 text-gray-600"></i>Tipo de Limpieza:</label>
                        <select id="cleaningType" name="cleaningType" class="rounded-lg" required>
                            <option value="">Selecciona el tipo de limpieza</option>
                            <option value="Apoyo de Cierre">Apoyo de Cierre</option>
                            <option value="Limpieza Profunda">Limpieza Profunda</option>
                        </select>
                    </div>

                    <!-- Secci√≥n de Informaci√≥n General -->
                    <div class="input-group">
                        <label for="reportDate"><i class="fas fa-calendar-alt mr-2 text-gray-600"></i>Fecha:</label>
                        <input type="date" id="reportDate" name="reportDate" class="rounded-lg" required>
                    </div>

                    <div class="input-group">
                        <label for="supervisorName"><i class="fas fa-user-tie mr-2 text-gray-600"></i>Nombre del Supervisor:</label>
                        <input type="text" id="supervisorName" name="supervisorName" placeholder="Ingrese nombre del supervisor" class="rounded-lg" required>
                    </div>

                    <!-- Secci√≥n de Encargados de Limpieza Din√°micos -->
                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4"><i class="fas fa-users-cog mr-2 text-gray-700"></i>Encargados de Limpieza y sus Actividades</h2>
                    <div id="cleanersContainer" class="space-y-6">
                        <!-- Los encargados se a√±adir√°n aqu√≠ din√°micamente -->
                    </div>
                    <button type="button" id="addCleanerBtn" class="btn btn-secondary w-full"><i class="fas fa-user-plus mr-2"></i>A√±adir Otro Encargado de Limpieza</button>

                    <!-- Bot√≥n de Env√≠o a WhatsApp -->
                    <button type="submit" class="btn btn-primary w-full mt-8"><i class="fab fa-whatsapp mr-2"></i>Enviar Reporte por WhatsApp</button>
                </form>

                <div id="messageBox" class="message-box mt-4">
                    <p><i class="fas fa-exclamation-triangle mr-2"></i>Por favor, complete todos los campos requeridos antes de enviar.</p>
                </div>
            </div>
        </div>

        <!-- Pesta√±a: Asignar √Åreas de Limpieza Apoyo Cierre -->
        <div id="assignAreasTab" class="tab-content">
            <div class="form-section-container">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8"><i class="fas fa-tasks mr-2 text-blue-600"></i>Asignar √Åreas de Limpieza Apoyo Cierre</h1>

                <form id="assignAreasForm" class="space-y-6">
                    <div class="input-group">
                        <label for="assignReportType"><i class="fas fa-folder-open mr-2 text-gray-600"></i>Tipo de Reporte:</label>
                        <select id="assignReportType" name="assignReportType" class="rounded-lg" required>
                            <option value="">Selecciona el tipo de reporte</option>
                            <option value="Dulcer√≠a">Dulcer√≠a</option>
                            <option value="Operaciones">Operaciones</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="assignDate"><i class="fas fa-calendar-alt mr-2 text-gray-600"></i>Fecha:</label>
                        <input type="date" id="assignDate" name="assignDate" class="rounded-lg" required>
                    </div>

                    <div class="input-group">
                        <label for="assignSupervisorName"><i class="fas fa-user-tie mr-2 text-gray-600"></i>Supervisor Responsable:</label>
                        <input type="text" id="assignSupervisorName" name="assignSupervisorName" placeholder="Ingrese nombre del supervisor" class="rounded-lg" required>
                    </div>

                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4"><i class="fas fa-users mr-2 text-gray-700"></i>Responsables de Limpieza Asignados</h2>
                    <div id="responsibleCleanersContainer" class="space-y-6">
                        <!-- Dynamic responsible cleaner sections will go here -->
                    </div>
                    <button type="button" id="addResponsibleCleanerBtn" class="btn btn-secondary w-full"><i class="fas fa-user-plus mr-2"></i>A√±adir Otro Responsable</button>

                    <button type="submit" class="btn btn-primary w-full mt-8"><i class="fab fa-whatsapp mr-2"></i>Enviar Asignaci√≥n por WhatsApp</button>
                </form>

                <div id="assignMessageBox" class="message-box mt-4">
                    <p><i class="fas fa-exclamation-triangle mr-2"></i>Por favor, complete todos los campos requeridos antes de enviar.</p>
                </div>
            </div>
        </div>

        <!-- Pesta√±a: Actividades Entrega de Turno Administrativos -->
        <div id="turnoEntregaTab" class="tab-content">
            <div class="form-section-container">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8"><i class="fas fa-handshake mr-2 text-blue-600"></i>Actividades Entrega de Turno</h1>

                <form id="turnoEntregaForm" class="space-y-6">
                    <div class="input-group">
                        <label for="entregaDate"><i class="fas fa-calendar-alt mr-2 text-gray-600"></i>Fecha:</label>
                        <input type="date" id="entregaDate" name="entregaDate" class="rounded-lg" required>
                    </div>

                    <div class="input-group">
                        <label for="entregaSupervisorName"><i class="fas fa-user-tie mr-2 text-gray-600"></i>Supervisor Responsable:</label>
                        <input type="text" id="entregaSupervisorName" name="entregaSupervisorName" placeholder="Ingrese nombre del supervisor" class="rounded-lg" required>
                    </div>

                    <!-- Secci√≥n Actividades Administrativas -->
                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4"><i class="fas fa-clipboard-list mr-2 text-gray-700"></i>Actividades Administrativas</h2>
                    <div id="adminActivitiesContainer" class="space-y-4">
                        <!-- Activities here -->
                    </div>
                    <button type="button" id="addAdminActivityBtn" class="btn btn-secondary w-full mt-4"><i class="fas fa-plus-circle mr-2"></i>A√±adir Actividad Administrativa Adicional</button>
                    <div class="input-group mt-6">
                        <label for="commentsAdmin"><i class="fas fa-comment-dots mr-2 text-gray-600"></i>Comentarios (Actividades Administrativas):</label>
                        <textarea id="commentsAdmin" name="commentsAdmin" rows="3" placeholder="Observaciones generales para actividades administrativas..." class="rounded-lg"></textarea>
                    </div>

                    <!-- Secci√≥n Dulcer√≠a -->
                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4"><i class="fas fa-candy-cane mr-2 text-gray-700"></i>Dulcer√≠a</h2>
                    <div id="dulceriaActivitiesContainer" class="space-y-4">
                        <!-- Activities here -->
                    </div>
                    <button type="button" id="addDulceriaActivityBtn" class="btn btn-secondary w-full mt-4"><i class="fas fa-plus-circle mr-2"></i>A√±adir Actividad de Dulcer√≠a Adicional</button>
                    <div class="input-group mt-6">
                        <label for="commentsDulceria"><i class="fas fa-comment-dots mr-2 text-gray-600"></i>Comentarios (Dulcer√≠a):</label>
                        <textarea id="commentsDulceria" name="commentsDulceria" rows="3" placeholder="Observaciones generales para dulcer√≠a..." class="rounded-lg"></textarea>
                    </div>

                    <!-- Secci√≥n Operaciones -->
                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4"><i class="fas fa-industry mr-2 text-gray-700"></i>Operaciones</h2>
                    <div id="operacionesActivitiesContainer" class="space-y-4">
                        <!-- Activities here -->
                    </div>
                    <button type="button" id="addOperacionesActivityBtn" class="btn btn-secondary w-full mt-4"><i class="fas fa-plus-circle mr-2"></i>A√±adir Actividad de Operaciones Adicional</button>
                    <div class="input-group mt-6">
                        <label for="commentsOperaciones"><i class="fas fa-comment-dots mr-2 text-gray-600"></i>Comentarios (Operaciones):</label>
                        <textarea id="commentsOperaciones" name="commentsOperaciones" rows="3" placeholder="Observaciones generales para operaciones..." class="rounded-lg"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary w-full mt-8"><i class="fab fa-whatsapp mr-2"></i>Enviar Reporte de Entrega de Turno por WhatsApp</button>
                </form>

                <div id="entregaMessageBox" class="message-box mt-4">
                    <p><i class="fas fa-exclamation-triangle mr-2"></i>Por favor, complete todos los campos requeridos antes de enviar.</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- L√≥gica de las pesta√±as ---
        function showTab(tabId) {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelector(`.tab-button[onclick*="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Asegurar que la primera pesta√±a est√© activa al cargar
            showTab('cleaningReportTab');

            // --- L√≥gica para el Formulario de Reporte de Limpieza (Pesta√±a 1) ---
            (function() {
                const cleaningReportForm = document.getElementById('cleaningReportForm');
                const cleanersContainer = document.getElementById('cleanersContainer');
                const addCleanerBtn = document.getElementById('addCleanerBtn');
                const messageBox = document.getElementById('messageBox');

                let cleanerCounter = 0;

                function addCleaningArea(cleanerAreaContainer) {
                    const areaId = `area_report_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
                    const areaDiv = document.createElement('div');
                    areaDiv.classList.add('area-item');
                    areaDiv.dataset.areaId = areaId;

                    areaDiv.innerHTML = `
                        <input type="text" name="areaName_${areaId}" placeholder="Nombre del √Årea (Ej: Ba√±os, Cocina)" class="rounded-lg flex-grow" required>
                        <span class="status-label text-red-500 font-bold" data-status="dirty"><i class="fas fa-times-circle mr-1"></i>SUCIO</span>
                        <label class="toggle-switch">
                            <input type="checkbox" name="areaStatus_${areaId}">
                            <span class="slider round"></span>
                        </label>
                        <span class="status-label text-green-500 font-bold hidden" data-status="clean"><i class="fas fa-check-circle mr-1"></i>LIMPIO</span>
                        <button type="button" class="btn btn-danger p-2 rounded-full flex-shrink-0 remove-area-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                    cleanerAreaContainer.appendChild(areaDiv);

                    const removeBtn = areaDiv.querySelector('.remove-area-btn');
                    removeBtn.addEventListener('click', () => {
                        areaDiv.remove();
                    });

                    const statusCheckbox = areaDiv.querySelector(`input[name="areaStatus_${areaId}"]`);
                    const dirtyLabel = areaDiv.querySelector('span[data-status="dirty"]');
                    const cleanLabel = areaDiv.querySelector('span[data-status="clean"]');

                    statusCheckbox.addEventListener('change', (event) => {
                        if (event.target.checked) {
                            dirtyLabel.classList.add('hidden');
                            cleanLabel.classList.remove('hidden');
                        } else {
                            dirtyLabel.classList.remove('hidden');
                            cleanLabel.classList.add('hidden');
                        }
                    });
                }

                function addCleanerSection() {
                    cleanerCounter++;
                    const cleanerSectionId = `cleaner_report_${cleanerCounter}`;
                    const cleanerDiv = document.createElement('div');
                    cleanerDiv.classList.add('cleaner-section');
                    cleanerDiv.dataset.cleanerId = cleanerSectionId;

                    cleanerDiv.innerHTML = `
                        <button type="button" class="remove-cleaner-btn">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="input-group mb-4">
                            <label for="cleanerName_${cleanerSectionId}"><i class="fas fa-user mr-2 text-gray-600"></i>Nombre del Encargado de Limpieza:</label>
                            <input type="text" id="cleanerName_${cleanerSectionId}" name="cleanerName_${cleanerSectionId}" placeholder="Ingrese nombre del encargado" class="rounded-lg" required>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-600 mb-3"><i class="fas fa-tasks mr-2 text-gray-600"></i>√Åreas de Limpieza Asignadas:</h3>
                        <div id="cleaningAreasContainer_${cleanerSectionId}" class="cleaning-areas-container space-y-4">
                            <!-- Las √°reas para este encargado se a√±adir√°n aqu√≠ din√°micamente -->
                        </div>
                        <button type="button" class="btn btn-secondary w-full mt-4 add-area-btn"><i class="fas fa-plus-circle mr-2"></i>A√±adir √Årea para este Encargado</button>
                        <div class="input-group mt-6">
                            <label for="comments_${cleanerSectionId}"><i class="fas fa-comment-dots mr-2 text-gray-600"></i>Comentarios Adicionales para este Encargado:</label>
                            <textarea id="comments_${cleanerSectionId}" name="comments_${cleanerSectionId}" rows="3" placeholder="Observaciones espec√≠ficas para este encargado..." class="rounded-lg"></textarea>
                        </div>
                    `;
                    cleanersContainer.appendChild(cleanerDiv);

                    const removeCleanerBtn = cleanerDiv.querySelector('.remove-cleaner-btn');
                    removeCleanerBtn.addEventListener('click', () => {
                        cleanerDiv.remove();
                    });

                    const addAreaBtnForCleaner = cleanerDiv.querySelector('.add-area-btn');
                    const cleanerAreaContainer = cleanerDiv.querySelector(`.cleaning-areas-container`);

                    addAreaBtnForCleaner.addEventListener('click', () => {
                        addCleaningArea(cleanerAreaContainer);
                    });

                    addCleaningArea(cleanerAreaContainer); // Add initial area
                }

                addCleanerSection(); // Add initial cleaner section

                addCleanerBtn.addEventListener('click', addCleanerSection);

                cleaningReportForm.addEventListener('submit', (event) => {
                    event.preventDefault();

                    const reportType = document.getElementById('reportType').value;
                    const cleaningType = document.getElementById('cleaningType').value;
                    const reportDate = document.getElementById('reportDate').value;
                    const supervisorName = document.getElementById('supervisorName').value.trim();

                    if (!reportType || !cleaningType || !reportDate || !supervisorName) {
                        messageBox.textContent = 'Por favor, complete todos los campos de informaci√≥n general (Tipo de Reporte, Tipo de Limpieza, Fecha, Supervisor).';
                        messageBox.style.display = 'block';
                        return;
                    }

                    const allCleanerSections = cleanersContainer.querySelectorAll('.cleaner-section');
                    if (allCleanerSections.length === 0) {
                        messageBox.textContent = 'Debe a√±adir al menos un encargado de limpieza.';
                        messageBox.style.display = 'block';
                        return;
                    }

                    let allCleanersValid = true;
                    let allAreasValid = true;
                    const cleanersData = [];

                    allCleanerSections.forEach(cleanerDiv => {
                        const cleanerNameInput = cleanerDiv.querySelector('input[type="text"]');
                        const cleanerName = cleanerNameInput.value.trim();
                        const commentsInput = cleanerDiv.querySelector('textarea');

                        if (!cleanerName) {
                            allCleanersValid = false;
                        }

                        const areasForThisCleaner = [];
                        const currentCleaningAreasContainer = cleanerDiv.querySelector('.cleaning-areas-container');
                        const areaItems = currentCleaningAreasContainer.querySelectorAll('.area-item');

                        if (areaItems.length === 0) {
                            allAreasValid = false;
                        }

                        areaItems.forEach(areaDiv => {
                            const areaNameInput = areaDiv.querySelector('input[type="text"]');
                            const areaStatusCheckbox = areaDiv.querySelector('input[type="checkbox"]');

                            if (!areaNameInput.value.trim()) {
                                allAreasValid = false;
                            }

                            areasForThisCleaner.push({
                                name: areaNameInput.value.trim(),
                                status: areaStatusCheckbox.checked ? 'LIMPIO' : 'SUCIO'
                            });
                        });

                        cleanersData.push({
                            name: cleanerName,
                            areas: areasForThisCleaner,
                            comments: commentsInput.value.trim()
                        });
                    });

                    if (!allCleanersValid) {
                        messageBox.textContent = 'Por favor, ingrese el nombre para todos los encargados de limpieza.';
                        messageBox.style.display = 'block';
                        return;
                    }

                    if (!allAreasValid) {
                        messageBox.textContent = 'Por favor, ingrese el nombre para todas las √°reas de limpieza asignadas a cada encargado.';
                        messageBox.style.display = 'block';
                        return;
                    }

                    messageBox.style.display = 'none';

                    const formData = {
                        reportType: reportType,
                        cleaningType: cleaningType,
                        date: reportDate,
                        supervisor: supervisorName,
                        cleaners: cleanersData,
                    };

                    let whatsappMessage = `*Reporte de Limpieza - ${formData.reportType.replace('Reporte de Limpieza ', '')} (${formData.cleaningType})*\n\n`;
                    whatsappMessage += `*Fecha:* ${formData.date}\n`;
                    whatsappMessage += `*Supervisor:* ${formData.supervisor}\n\n`;

                    whatsappMessage += `*Encargados de Limpieza y sus Actividades:*\n`;
                    formData.cleaners.forEach(cleaner => {
                        whatsappMessage += `\n*${cleaner.name}:*\n`;
                        if (cleaner.areas.length > 0) {
                            cleaner.areas.forEach(area => {
                                whatsappMessage += `- ${area.name}: *${area.status}*\n`;
                            });
                        } else {
                            whatsappMessage += `  (No se asignaron √°reas de limpieza)\n`;
                        }
                        if (cleaner.comments) {
                            whatsappMessage += `  *Comentarios:* ${cleaner.comments}\n`;
                        }
                    });

                    const encodedMessage = encodeURIComponent(whatsappMessage);
                    window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
                });
            })(); // Fin de la l√≥gica del Formulario de Reporte de Limpieza

            // --- L√≥gica para el Formulario de Asignaci√≥n de √Åreas (Pesta√±a 2) ---
            (function() {
                const assignAreasForm = document.getElementById('assignAreasForm');
                const responsibleCleanersContainer = document.getElementById('responsibleCleanersContainer');
                const addResponsibleCleanerBtn = document.getElementById('addResponsibleCleanerBtn');
                const assignMessageBox = document.getElementById('assignMessageBox');

                let responsibleCleanerCounter = 0;

                // Function to add a new activity within a specific responsible cleaner's section
                function addAssignedActivity(responsibleCleanerActivitiesContainer) {
                    const activityId = `activity_assign_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
                    const activityDiv = document.createElement('div');
                    activityDiv.classList.add('area-item'); // Reusing styling
                    activityDiv.dataset.activityId = activityId;

                    activityDiv.innerHTML = `
                        <input type="text" name="activityName_${activityId}" placeholder="Descripci√≥n de la actividad" class="rounded-lg flex-grow" required>
                        <button type="button" class="btn btn-danger p-2 rounded-full flex-shrink-0 remove-activity-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                    responsibleCleanerActivitiesContainer.appendChild(activityDiv);

                    const removeBtn = activityDiv.querySelector('.remove-activity-btn');
                    removeBtn.addEventListener('click', () => {
                        activityDiv.remove();
                    });
                }

                // Function to add a new responsible cleaner section
                function addResponsibleCleanerSection() {
                    responsibleCleanerCounter++;
                    const responsibleCleanerSectionId = `responsible_assign_${responsibleCleanerCounter}`;
                    const responsibleCleanerDiv = document.createElement('div');
                    responsibleCleanerDiv.classList.add('cleaner-section'); // Reusing styling
                    responsibleCleanerDiv.dataset.responsibleCleanerId = responsibleCleanerSectionId;

                    responsibleCleanerDiv.innerHTML = `
                        <button type="button" class="remove-cleaner-btn">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="input-group mb-4">
                            <label for="responsibleName_${responsibleCleanerSectionId}"><i class="fas fa-user-hard-hat mr-2 text-gray-600"></i>Nombre del Responsable de Limpieza:</label>
                            <input type="text" id="responsibleName_${responsibleCleanerSectionId}" name="responsibleName_${responsibleCleanerSectionId}" placeholder="Ingrese nombre del responsable" class="rounded-lg" required>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-600 mb-3"><i class="fas fa-clipboard-check mr-2 text-gray-700"></i>Actividades Asignadas:</h3>
                        <div id="responsibleActivitiesContainer_${responsibleCleanerSectionId}" class="responsible-activities-container space-y-4">
                            <!-- Activities for this responsible will be added here dynamically -->
                        </div>
                        <button type="button" class="btn btn-secondary w-full mt-4 add-activity-btn-for-responsible"><i class="fas fa-plus-circle mr-2"></i>A√±adir Actividad para este Responsable</button>
                    `;
                    responsibleCleanersContainer.appendChild(responsibleCleanerDiv);

                    const removeResponsibleBtn = responsibleCleanerDiv.querySelector('.remove-cleaner-btn');
                    removeResponsibleBtn.addEventListener('click', () => {
                        responsibleCleanerDiv.remove();
                    });

                    const addActivityBtnForThisResponsible = responsibleCleanerDiv.querySelector('.add-activity-btn-for-responsible');
                    const responsibleActivitiesContainer = responsibleCleanerDiv.querySelector(`.responsible-activities-container`);

                    addActivityBtnForThisResponsible.addEventListener('click', () => {
                        addAssignedActivity(responsibleActivitiesContainer);
                    });

                    addAssignedActivity(responsibleActivitiesContainer); // Add initial activity
                }

                addResponsibleCleanerSection(); // Add initial responsible cleaner section

                addResponsibleCleanerBtn.addEventListener('click', addResponsibleCleanerSection);

                assignAreasForm.addEventListener('submit', (event) => {
                    event.preventDefault();

                    const assignReportType = document.getElementById('assignReportType').value;
                    const assignDate = document.getElementById('assignDate').value;
                    const assignSupervisorName = document.getElementById('assignSupervisorName').value.trim();

                    if (!assignReportType || !assignDate || !assignSupervisorName) {
                        assignMessageBox.textContent = 'Por favor, complete todos los campos principales (Tipo de Reporte, Fecha, Supervisor).';
                        assignMessageBox.style.display = 'block';
                        return;
                    }

                    const allResponsibleCleanerSections = responsibleCleanersContainer.querySelectorAll('.cleaner-section');
                    if (allResponsibleCleanerSections.length === 0) {
                        assignMessageBox.textContent = 'Debe a√±adir al menos un responsable de limpieza.';
                        assignMessageBox.style.display = 'block';
                        return;
                    }

                    let allResponsiblesValid = true;
                    let allActivitiesValid = true;
                    const responsiblesData = [];

                    allResponsibleCleanerSections.forEach(responsibleDiv => {
                        const responsibleNameInput = responsibleDiv.querySelector('input[type="text"]');
                        const responsibleName = responsibleNameInput.value.trim();

                        if (!responsibleName) {
                            allResponsiblesValid = false;
                        }

                        const activitiesForThisResponsible = [];
                        const currentResponsibleActivitiesContainer = responsibleDiv.querySelector('.responsible-activities-container');
                        const activityItems = currentResponsibleActivitiesContainer.querySelectorAll('.area-item');

                        if (activityItems.length === 0) {
                            allActivitiesValid = false;
                        }

                        activityItems.forEach(activityDiv => {
                            const activityNameInput = activityDiv.querySelector('input[type="text"]');

                            if (!activityNameInput.value.trim()) {
                                allActivitiesValid = false;
                            }
                            activitiesForThisResponsible.push(activityNameInput.value.trim());
                        });

                        responsiblesData.push({
                            name: responsibleName,
                            activities: activitiesForThisResponsible
                        });
                    });

                    if (!allResponsiblesValid) {
                        assignMessageBox.textContent = 'Por favor, ingrese el nombre para todos los responsables de limpieza.';
                        assignMessageBox.style.display = 'block';
                        return;
                    }

                    if (!allActivitiesValid) {
                        assignMessageBox.textContent = 'Por favor, ingrese una descripci√≥n para todas las actividades asignadas a cada responsable.';
                        assignMessageBox.style.display = 'block';
                        return;
                    }

                    assignMessageBox.style.display = 'none';

                    // Formatear mensaje para WhatsApp para la asignaci√≥n
                    let whatsappMessage = `*Asignaci√≥n de √Åreas de Limpieza - ${assignReportType}*\n\n`;
                    whatsappMessage += `*Fecha:* ${assignDate}\n`;
                    whatsappMessage += `*Supervisor Responsable:* ${assignSupervisorName}\n\n`;
                    whatsappMessage += `*Responsables de Limpieza Asignados y sus Actividades:*\n`;

                    responsiblesData.forEach(responsible => {
                        whatsappMessage += `\n*${responsible.name}:*\n`;
                        if (responsible.activities.length > 0) {
                            responsible.activities.forEach((activity, index) => {
                                whatsappMessage += `- ${activity}\n`;
                            });
                        } else {
                            whatsappMessage += `  (No se asignaron actividades)\n`;
                        }
                    });

                    const encodedMessage = encodeURIComponent(whatsappMessage);
                    window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
                });
            })(); // Fin de la l√≥gica del Formulario de Asignaci√≥n de √Åreas

            // --- L√≥gica para la Pesta√±a de Actividades Entrega de Turno (Pesta√±a 3) ---
            (function() {
                const turnoEntregaForm = document.getElementById('turnoEntregaForm');
                const adminActivitiesContainer = document.getElementById('adminActivitiesContainer');
                const dulceriaActivitiesContainer = document.getElementById('dulceriaActivitiesContainer');
                const operacionesActivitiesContainer = document.getElementById('operacionesActivitiesContainer');
                const entregaMessageBox = document.getElementById('entregaMessageBox');
                const addAdminActivityBtn = document.getElementById('addAdminActivityBtn'); // Get the new button
                const addDulceriaActivityBtn = document.getElementById('addDulceriaActivityBtn'); // New button for Dulceria
                const addOperacionesActivityBtn = document.getElementById('addOperacionesActivityBtn'); // New button for Operaciones

                const adminActivitiesList = [
                    "Stock Ideal",
                    "Revisar Programacion P&S",
                    "Toma I",
                    "Cortes Sorpresa",
                    "Limpieza de Comedor",
                    { name: "Bitacora de uniformes", hasSpecificComment: true, specificCommentPlaceholder: "Indicar a qui√©n se realiz√≥ y qui√©n queda pendiente" },
                    { name: "Retiro de fondos", hasSpecificComment: true, specificCommentPlaceholder: "Indicar a qui√©n se realiz√≥ y qui√©n queda pendiente" },
                    "Limpieza Almacen",
                    "Limpieza Sub Almacen"
                ];

                const dulceriaActivitiesList = [
                    "Revisi√≥n de limpieza profundas",
                    "Check List de habilitaci√≥n",
                    "Revisar y firmar bit√°coras",
                    "Picado y fechas Dulcer√≠a",
                    "Asignar √°reas de abastecimiento dulcer√≠a",
                    "Revisar horarios marquesina",
                    "Cinepolitos con todos sus insumos (Trapos, atomizador, cajita)"
                ];

                const operacionesActivitiesList = [
                    "Revisi√≥n de limpieza profundas",
                    "Abastecimiento Insumos",
                    "Check List de habilitaci√≥n",
                    "Revisi√≥n de sanitarios",
                    "Revisi√≥n de cuartos",
                    "Bit√°coras Sanitarios",
                    "Stock Ideal sanitarios",
                    "Limpieza de lobby",
                    "Charolas abastecidas",
                    "Sinopsis correcta",
                    "Arquilla ordenada limpia sin boletos",
                    "Limpieza de unifilas",
                    "Todos los basureros sin basura con bolsas fajadas",
                    "Salidas de emergencia Limpias",
                    "Cinepolitos con todos sus insumos (linterna, trapos, atomizadores, Cepillos)"
                ];

                // Function to create an activity item for the Turno Entrega form
                // Can now handle both predefined (activityConfig as string or object) and dynamic (activityConfig = null for dynamic admin activities)
                function createTurnoActivityItem(activityConfig, containerElement, isPredefined = true) {
                    const activityName = isPredefined ? (typeof activityConfig === 'object' ? activityConfig.name : activityConfig) : "";
                    const hasSpecificComment = typeof activityConfig === 'object' && activityConfig.hasSpecificComment;
                    const specificCommentPlaceholder = hasSpecificComment ? activityConfig.specificCommentPlaceholder : '';

                    const activityId = `entrega_activity_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
                    const activityDiv = document.createElement('div');
                    activityDiv.classList.add('activity-item-full');
                    activityDiv.dataset.activityType = isPredefined ? 'predefined' : 'dynamic';
                    if (isPredefined) {
                        activityDiv.dataset.activityName = activityName; // Store predefined name
                    }

                    activityDiv.innerHTML = `
                        <div class="activity-main-line">
                            <input type="checkbox" id="activity_${activityId}" name="activity_${activityId}" class="mr-3 text-green-500 form-checkbox h-5 w-5 rounded-md border-gray-300 shadow-sm focus:ring-green-500">
                            <label for="activity_${activityId}" class="flex items-center cursor-pointer text-lg font-medium text-gray-700 w-full md:w-auto">
                                ${isPredefined ? `<span class="activity-text">${activityName}</span>` : `<input type="text" name="dynamic_activity_name_${activityId}" placeholder="Nueva actividad" class="rounded-lg flex-grow p-1 border-gray-300 focus:border-blue-500 focus:ring-blue-500" required>`}
                                <span class="status-icon ml-3 text-red-500"><i class="fas fa-times-circle"></i></span>
                            </label>
                            ${!isPredefined ? `
                            <button type="button" class="btn btn-danger p-2 rounded-full flex-shrink-0 ml-auto remove-dynamic-activity-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            ` : ''}
                        </div>
                        <div class="not-done-comment-container w-full mt-2 md:mt-0 md:ml-auto ${isPredefined ? 'hidden' : ''}">
                            <input type="text" name="not_done_comment_${activityId}" placeholder="Motivo por el que no se realiz√≥" class="rounded-lg w-full p-2 border-gray-300 focus:border-red-500 focus:ring-red-500">
                        </div>
                        ${hasSpecificComment ? `
                        <div class="specific-comment-container w-full mt-2 md:mt-0 md:ml-auto">
                            <input type="text" name="specific_comment_${activityId}" placeholder="${specificCommentPlaceholder}" class="rounded-lg w-full p-2 border-gray-300 focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        ` : ''}
                    `;
                    containerElement.appendChild(activityDiv);

                    // Handle checkbox change
                    const checkbox = activityDiv.querySelector(`#activity_${activityId}`);
                    const statusIcon = activityDiv.querySelector('.status-icon');
                    const notDoneCommentContainer = activityDiv.querySelector('.not-done-comment-container');
                    const notDoneCommentInput = notDoneCommentContainer.querySelector('input');
                    const removeBtn = activityDiv.querySelector('.remove-dynamic-activity-btn'); // Only exists for dynamic activities

                    if (removeBtn) { // Add listener only if it's a dynamic activity
                        removeBtn.addEventListener('click', () => {
                            activityDiv.remove();
                        });
                    }

                    checkbox.addEventListener('change', () => {
                        if (checkbox.checked) {
                            statusIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                            statusIcon.classList.remove('text-red-500');
                            statusIcon.classList.add('text-green-500');
                            notDoneCommentContainer.classList.add('hidden');
                            notDoneCommentInput.value = ''; // Clear comment if marked done
                        } else {
                            statusIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                            statusIcon.classList.remove('text-green-500');
                            statusIcon.classList.add('text-red-500');
                            notDoneCommentContainer.classList.remove('hidden');
                        }
                    });

                    // Initial state for icon and comment field (default to not done)
                    if (checkbox.checked) {
                        statusIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                        statusIcon.classList.remove('text-red-500');
                        statusIcon.classList.add('text-green-500');
                        notDoneCommentContainer.classList.add('hidden');
                    } else {
                        statusIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                        statusIcon.classList.remove('text-green-500');
                        statusIcon.classList.add('text-red-500');
                        // For dynamic activities, the reason input should be visible by default
                        if (!isPredefined) {
                            notDoneCommentContainer.classList.remove('hidden');
                        }
                    }
                }

                // Function to get data for a section, now handles dynamic activities
                const getSectionActivitiesData = (containerId) => {
                    const container = document.getElementById(containerId);
                    const activitiesData = [];
                    const activityItems = container.querySelectorAll('.activity-item-full');

                    activityItems.forEach((item) => {
                        const checkbox = item.querySelector('input[type="checkbox"]');
                        const notDoneCommentInput = item.querySelector('input[name^="not_done_comment_"]');
                        const specificCommentInput = item.querySelector('input[name^="specific_comment_"]');

                        let activityName;
                        // Check if it's a dynamic activity (has a text input for its name)
                        const dynamicNameInput = item.querySelector('input[name^="dynamic_activity_name_"]');
                        if (dynamicNameInput) {
                            activityName = dynamicNameInput.value.trim();
                        } else {
                            // For predefined activities, get name from data-activity-name attribute
                            activityName = item.dataset.activityName;
                        }

                        activitiesData.push({
                            name: activityName,
                            completed: checkbox.checked,
                            notDoneReason: checkbox.checked ? '' : notDoneCommentInput.value.trim(),
                            specificComment: specificCommentInput ? specificCommentInput.value.trim() : ''
                        });
                    });
                    return activitiesData;
                };


                // Populate initial activities for each section
                adminActivitiesList.forEach(activity => createTurnoActivityItem(activity, adminActivitiesContainer));
                dulceriaActivitiesList.forEach(activity => createTurnoActivityItem(activity, dulceriaActivitiesContainer));
                operacionesActivitiesList.forEach(activity => createTurnoActivityItem(activity, operacionesActivitiesContainer));

                // Add event listener for the "Add Administrative Activity" button
                addAdminActivityBtn.addEventListener('click', () => {
                    createTurnoActivityItem(null, adminActivitiesContainer, false); // Pass false for isPredefined
                });

                // Add event listener for the "Add Dulceria Activity" button
                addDulceriaActivityBtn.addEventListener('click', () => {
                    createTurnoActivityItem(null, dulceriaActivitiesContainer, false); // Pass false for isPredefined
                });

                // Add event listener for the "Add Operaciones Activity" button
                addOperacionesActivityBtn.addEventListener('click', () => {
                    createTurnoActivityItem(null, operacionesActivitiesContainer, false); // Pass false for isPredefined
                });


                turnoEntregaForm.addEventListener('submit', (event) => {
                    event.preventDefault();

                    const entregaDate = document.getElementById('entregaDate').value;
                    const entregaSupervisorName = document.getElementById('entregaSupervisorName').value.trim();

                    if (!entregaDate || !entregaSupervisorName) {
                        entregaMessageBox.textContent = 'Por favor, complete los campos de Fecha y Supervisor Responsable.';
                        entregaMessageBox.style.display = 'block';
                        return;
                    }

                    // Gather data for each section
                    const adminActivitiesData = getSectionActivitiesData('adminActivitiesContainer');
                    const dulceriaActivitiesData = getSectionActivitiesData('dulceriaActivitiesContainer');
                    const operacionesActivitiesData = getSectionActivitiesData('operacionesActivitiesContainer');

                    // Validation for dynamic activities (ensure name is not empty if comment is also empty)
                    const validateDynamicActivities = (activitiesData, sectionName) => {
                        const emptyDynamicActivities = activitiesData.filter(activity =>
                            activity.name === '' && !activity.completed && activity.notDoneReason === '' && item.dataset.activityType === 'dynamic' // Check if it's dynamic and empty
                        );
                        if (emptyDynamicActivities.length > 0) {
                            entregaMessageBox.textContent = `Por favor, ingrese un nombre para todas las actividades adicionales de ${sectionName} o indique el motivo por el que no se realizaron.`;
                            entregaMessageBox.style.display = 'block';
                            return false;
                        }
                        return true;
                    };

                    if (!validateDynamicActivities(adminActivitiesData, 'Administrativas')) return;
                    if (!validateDynamicActivities(dulceriaActivitiesData, 'Dulcer√≠a')) return;
                    if (!validateDynamicActivities(operacionesActivitiesData, 'Operaciones')) return;


                    const commentsAdmin = document.getElementById('commentsAdmin').value.trim();
                    const commentsDulceria = document.getElementById('commentsDulceria').value.trim();
                    const commentsOperaciones = document.getElementById('commentsOperaciones').value.trim();

                    // Format message for WhatsApp
                    let whatsappMessage = `*Reporte de Entrega de Turno Administrativos*\n\n`;
                    whatsappMessage += `*Fecha:* ${entregaDate}\n`;
                    whatsappMessage += `*Supervisor Responsable:* ${entregaSupervisorName}\n\n`;

                    // Helper to format activities for WhatsApp
                    const formatActivitiesForWhatsapp = (activities, sectionTitle) => {
                        let sectionMessage = `*--- ${sectionTitle} ---*\n`;
                        if (activities.length > 0) {
                            activities.forEach(activity => {
                                sectionMessage += `- ${activity.name}: *${activity.completed ? 'Realizada ‚úÖ' : 'No Realizada ‚ùå'}*\n`;
                                if (!activity.completed && activity.notDoneReason) {
                                    sectionMessage += `  _Motivo: ${activity.notDoneReason}_\n`;
                                }
                                if (activity.specificComment) {
                                    sectionMessage += `  _Comentario: ${activity.specificComment}_\n`;
                                }
                            });
                        } else {
                            sectionMessage += `  (No se registraron actividades)\n`;
                        }
                        return sectionMessage;
                    };


                    whatsappMessage += formatActivitiesForWhatsapp(adminActivitiesData, 'Actividades Administrativas');
                    if (commentsAdmin) {
                        whatsappMessage += `*Comentarios Generales (Admin):* ${commentsAdmin}\n`;
                    }
                    whatsappMessage += `\n`;


                    whatsappMessage += formatActivitiesForWhatsapp(dulceriaActivitiesData, 'Dulcer√≠a');
                    if (commentsDulceria) {
                        whatsappMessage += `*Comentarios Generales (Dulcer√≠a):* ${commentsDulceria}\n`;
                    }
                    whatsappMessage += `\n`;


                    whatsappMessage += formatActivitiesForWhatsapp(operacionesActivitiesData, 'Operaciones');
                    if (commentsOperaciones) {
                        whatsappMessage += `*Comentarios Generales (Operaciones):* ${commentsOperaciones}\n`;
                    }
                    whatsappMessage += `\n`;

                    const encodedMessage = encodeURIComponent(whatsappMessage);
                    window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
                });
            })(); // Fin de la l√≥gica de la Pesta√±a de Actividades Entrega de Turno
        });
    </script>
</body>
</html>
